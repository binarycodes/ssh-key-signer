name: go-ssh-keysign

on:
  push:
    branches: [ '*' ]
    paths:
      - go-ssh-keysign/**
      - .github/workflows/go-ssh-keysign-workflow.yml
      - .github/workflows/go-build.yml

jobs:
  set-version:
    runs-on: ubuntu-latest
    outputs:
      short_sha: ${{ steps.get-sha.outputs.short_sha }}
    steps:
      - name: Get short SHA
        id: get-sha
        run: echo "short_sha=$(echo $GITHUB_SHA | cut -c1-7)" >> $GITHUB_OUTPUT

  run:
    needs: set-version
    uses: ./.github/workflows/go-build.yml
    with:
      service: go-ssh-keysign
      artifactVersion: ${{ needs.set-version.outputs.short_sha }}
    secrets:
      GPG_PRIVATE_KEY: ${{ secrets.GPG_PRIVATE_KEY }}
      GPG_PASSPHRASE: ${{ secrets.GPG_PASSPHRASE }}
